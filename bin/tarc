#!/bin/bash

#
# TODO: *.tar.xz などのアーカイブファイルを除去する設定
#

RAR=/unix/koichi/prog/wrar371j/WinRAR

dst=$1
src=$2

if [[ ! $dst ]]; then
  if [[ ${0:0:1} == '.' ]]; then
    self=$0
  elif [[ $(type -p "${0##*/}") == "$0" ]]; then
    self=${0##*/}
  else
    self=$0
  fi
  
  echo "usage: $self <dstfile> <srcfiles>+"
  exit 1
fi

if [[ -e $dst ]]; then
  echo "Specified destination file '$1' is already exists!"
  exit 1
fi

if [[ -x $RAR ]]; then
  case "$dst" in
  (*.exe)
    if [[ -d $src ]]; then
      "$RAR" a -msrar -m5 -s -sfx -r "$@"
    else
      "$RAR" a -msrar -m5 -s -sfx "$@"
    fi
    return ;;
  (*.rar)
    if [[ -d $src ]]; then
      "$RAR" a -msrar -m5 -s -r "$@"
    else
      "$RAR" a -msrar -m5 -s "$@"
    fi
    return ;;
  esac
fi

if type tar &>/dev/null; then
  case "$dst" in
  (*.lzma|*.tlz)
    tar --lzma -cvf "$dst" "$src"
    return ;;
  (*.bz2|*.tbz)
    tar cjvf "$dst" "$src"
    return ;;
  (*.gz|*.tgz)
    tar czvf "$dst" "$src"
    return ;;
  (*.xz|*.txz)
    #tar cvf - "$src" | xz -7 > "$dst"
    tar --xz -cvf "$@"
    return ;;
  esac
fi

echo 'unknown filetype' >&2
return 1
